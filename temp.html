<!-- cyberball game---> 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cyberball Task</title>

  <style>
    .highlight-clickable {
        filter: drop-shadow(0 0 7px yellow);
        transition: filter 0.3s ease-in-out;
    }

    .player-label {
        text-align: center;
        font-weight: bold;
        background-color: rgba(255, 255, 255, 0.7);
        padding: 2px 60px;
        border-radius: 3px;
        font-size: 14px;
    }

    #popupDialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 9999;
        }

    #overlay {
            display: none;
            position: fixed;
            pointer-events: none;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
    
    #rulesBtn {
    position: fixed;      /* fixed so it stays in view */
    top: 10px;            /* distance from top */
    left: 10px;           /* distance from left */
    padding: 10px 10px;    /* smaller button */
    font-size: 16px;      /* smaller text */
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    z-index: 10000;       /* keep it on top */
}

  </style>

  <!-- jsPsych core + plugins -->
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-likert@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-multi-select@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@2.0.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" />
  <script src="https://unpkg.com/@jspsych/plugin-call-function@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
</head>



<body>
    <div id = "scoreboard" style = "
                position: absolute;
                display: none;
                top: 5px; left: 85%; transform: translateX(-50%);
                font-size: 16px; color: black; font-weight: bold;
                padding: 10px; background-color: lightgray; border-radius: 5px;
                z-index: 10000;
                ">
                <div><u>Player's Scores</u></div>
                <div>SP1: <span id="sp1-count">0</span><br>SP2: <span id="sp2-count">0</span></div>
    </div>
    
    <button id="rulesBtn" onclick="popupFn()" disabled>
      Open Cyberball Rules
    </button>
    <div id = "overlay"></div>
    <div id = "popupDialog">
      <h2><u>Cyberball Rules</u></h2>
      <div id = "rulesText"></div>
    <button onclick="closeFn()">Close</button> 
    </div>
    
</body>


<script>
  //fix the timing -> throw is too fast; the highlight doesn't ease out until the ball is already thrown (this means each throw is < 0.3 sec)
  var jsPsych = initJsPsych();

  var timeline = [];
  

  const subject_id = jsPsych.randomization.randomID(10);
    jsPsych.data.addProperties({ subject_id: subject_id });
    const filename = `${subject_id}.csv`;

    var experiment_date = new Date().toISOString().slice(0,10);
    jsPsych.data.addProperties({
    experiment_date: experiment_date
  });

  // capture info from Prolific
  //var subject_id = jsPsych.data.getURLVariable('PROLIFIC_PID'); do not capture prolific PID yet
  var prolific_id = jsPsych.data.getURLVariable('PROLIFIC_PID') || null; 
  var study_id = jsPsych.data.getURLVariable('STUDY_ID') || null;
  var session_id = jsPsych.data.getURLVariable('SESSION_ID') || null;

  var prolific_id_last4 = prolific_id ? prolific_id.slice(-4) : "NA";

  jsPsych.data.addProperties({
    prolific_id_last4: prolific_id_last4,
    study_id: study_id,
    session_id: session_id,
    version: 'Pilot_1' // add version number for data tracking
  });

  //preload images here --TO DO
  var preload = {
    type: jsPsychPreload,
    images: [
      "Images/throw-1.png",
      "Images/throw-2.png",
      "Images/throw-3.png",
      "Images/throw-4.png",
      "Images/catch2right.png",
      "Images/catch2left.png",
      "Images/idle-right.png",
      "Images/idle-left.png",
      "Images/Ball.png",
      "Images/3pl.png",
      //"exp_code/Images/Loading_icon.gif", 
    ]
  };

  timeline.push(preload);
  //throw animation frames
    const THROW_FRAMES = [
    "Images/throw-1.png",
    "Images/throw-2.png",
    "Images/throw-3.png",
    "Images/throw-4.png"
  ];

  //anchor the ball throwing angle to the player images 
  const PLAYER_ANCHORS = {
      Treasurer: { x: 0.84, y: 0.30 }, // ball leaves from treasurer's hand
      SP1:       { x: 0.84, y: 0.30 }, // participant's throwing hand
      SP2:       { x: 0.05, y: 0.30 }  // mirrored for right-left facing
  };

  function getAnchorPoint(playerId) {
    const elem = document.getElementById(playerId);
    const rect = elem.getBoundingClientRect();
    const containerRect = document.getElementById("cyberball-container").getBoundingClientRect();
    const anchor = PLAYER_ANCHORS[playerId];

    return {
        x: rect.left - containerRect.left + rect.width  * anchor.x - 5, // -15 centers the ball
        y: rect.top  - containerRect.top  + rect.height * anchor.y - 5
    };
}

  const THROW_FRAME_DURATION = 60; // duration of each throw frame in ms

    var treasurerThrowCount_SP1 = 0;
    var treasurerThrowCount_SP2 = 0;

    function updateScoreboard() {
    document.getElementById("sp1-count").textContent = treasurerThrowCount_SP1;
    document.getElementById("sp2-count").textContent = treasurerThrowCount_SP2;
  }


  //create game display 
  var cyberball_display = {
    type: jsPsychHtmlKeyboardResponse, 
    stimulus: `
      <div id="cyberball-container" style="
        position: relative;
        align-items: center;
        width: 1000px;
        height: 650px;
        margin: 0 auto;
        border: 1px solid white;
      ">

        <div style="position:absolute; top:5%; left:50%; transform:translateX(-50%); width:200px; text-align:center;">
          <img id="Treasurer" data-id="Treasurer" src="Images/idle-right.png"
              style="width:200px; height:200px;">
          <div class="player-label">Treasurer</div>
        </div>

        <div style="position:absolute; top:65%; left:100px; width:200px; text-align:center;">
          <img id="SP1" data-id="SP1" src="Images/idle-right.png"
              style="width:200px; height:200px;">
          <div class="player-label">You (SP1)</div>
        </div>

        <div style="position:absolute; top:65%; right:100px; width:200px; text-align:center;">
          <img id="SP2" data-id="SP2" src="Images/idle-left.png"
              style="width:200px; height:200px;">
          <div class="player-label">SP2</div>
        </div>

        <img id="Ball" src="Images/Ball.png"
            style="position:absolute; width:30px; height:30px; display:none; z-index:9990;">
      </div>
      `,
    choices: "NO_KEYS", 
    trial_duration: null,
  };
    


  //game wide parameters 
  const ball_travel_time = 1500; //in ms 
  const total_throws = 32;
  var current_throw = 0; 
  var current_ball_holder = "Treasurer"; 
  function randomPause(min = 1000, max = 3000){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }; // random pause between bot throws (1-3s)


//animate throw function
  function animateThrowFrames(fromId, toId, callback) {
  const ball = document.getElementById("Ball");
  const container = document
    .getElementById("cyberball-container")
    .getBoundingClientRect();

  const fromElem = document.getElementById(fromId);
  const toElem = document.getElementById(toId);

  const from = fromElem.getBoundingClientRect();
  const to = toElem.getBoundingClientRect();
  

  // --- CENTER-TO-CENTER coordinates (fixes angle issues) ---

    const start = getAnchorPoint(fromId);
    const end   = getAnchorPoint(toId);

    const startX = start.x;
    const startY = start.y;
    const endX   = end.x;
    const endY   = end.y;

  const duration = ball_travel_time;
  const startTime = performance.now();


  // --- face correct direction ---
  fromElem.style.transform = (endX < startX) ? "scaleX(-1)" : "scaleX(1)";

  ball.style.display = "block";
  ball.style.left = startX + "px";
  ball.style.top  = startY + "px";

  function step(now) {
    const elapsed = now - startTime;
    const t = Math.min(elapsed / duration, 1);
    const easedT = t * (2 - t); // ease-out effect

    // ---- BALL POSITION ----
    ball.style.left = (startX + (endX - startX) * easedT) + "px";
    ball.style.top  = (startY + (endY - startY) * easedT) + "px";

    // ---- THROW FRAMES ----
    const frameIndex = Math.min(
      Math.floor(elapsed / THROW_FRAME_DURATION),
      THROW_FRAMES.length - 1
    );
    fromElem.src = THROW_FRAMES[frameIndex];

    if (t < 1) {
      requestAnimationFrame(step);
    } else {
      finishThrow();
    }
  }

  function finishThrow() {
    // update scores if thrown to Treasurer
    if (toId === "Treasurer") {
      if (fromId === "SP1") {
        treasurerThrowCount_SP1 += 1;
      } else if (fromId === "SP2") {
        treasurerThrowCount_SP2 += 1;
      }
      updateScoreboard();
    }

    // reset thrower
    fromElem.src = fromId === "SP2"
      ? "Images/idle-left.png"
      : "Images/idle-right.png";
    fromElem.style.transform = "scaleX(1)";

    // ---- CATCH FRAME ----
    if (toId === "SP2") {
      toElem.src = "Images/catch2left.png";
    } else {
      toElem.src = "Images/catch2right.png";
    }

    // ---- HOLD BALL BRIEFLY (tracking aid) ----
    ball.style.left = endX + "px";
    ball.style.top  = endY + "px";

    setTimeout(() => {
      ball.style.display = "none";
      toElem.src = toId === "SP2"
        ? "Images/idle-left.png"
        : "Images/idle-right.png";

      if (callback) callback();
    }, 700); // üëà how long ball stays visible after catch
  }

  requestAnimationFrame(step);
}




  //randomly assign conditions
  const condition = jsPsych.randomization.sampleWithoutReplacement([1,2,3,4], 1)[0];
  jsPsych.data.addProperties({ condition: condition });

  

  //---- CREATE CONDITIONS ---- // 

  //condition 1 = equitable treasurer (8:8)
  var schedule_condition_1 = [ 
    {from: "Treasurer", to: "SP2"},
    {from: "SP2", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP2"}, //5 
    {from: "SP2", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, //10
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, //15 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, //20
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, //25
    {from: "SP1", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, //30
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"} //32
  ]; 
  //condition 2 = inequitable treasurer, no passing (4:12)
  var schedule_condition_2 = [
    {from: "Treasurer", to: "SP2"},
    {from: "SP2", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP2"}, //5 
    {from: "SP2", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, //10
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, //15 
    {from: "SP1", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"}, //20
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, //25
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"}, //30
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"} //32
  ]; 
  //condition 3 = inequitable treasurer, passing allowed and acted on 0 times (3:13)
  var schedule_condition_3 = [
    {from: "Treasurer", to: "SP2"},
    {from: "SP2", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP2"}, //5 
    {from: "SP2", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, //10
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP1"}, //15 
    {from: "SP1", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"}, //20
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, //25
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"}, //30
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"} //32
  ]; 
  //condition 4 = inequitable treasurer, passing allowed and acted on 5 times (8:8)
  var schedule_condition_4 = [
    {from: "Treasurer", to: "SP2"},
    {from: "SP2", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, //1:1
    {from: "Treasurer", to: "SP2"}, //5 
    {from: "SP2", to: "Treasurer"}, 
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"}, //3:1
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, //10 and 3:2
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"}, //4:2
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"}, //5:2
    {from: "Treasurer", to: "SP1"}, //15 
    {from: "SP1", to: "Treasurer"}, //5:3
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "SP1"},
    {from: "SP1", to: "Treasurer"}, //5:4
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "Treasurer"}, //20 and 6:4 
    {from: "Treasurer", to: "SP1"}, 
    {from: "SP1", to: "Treasurer"}, //7:5
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "SP1"},
    {from: "SP1", to: "Treasurer"}, //7:6
    {from: "Treasurer", to: "SP2"}, //25
    {from: "SP2", to: "Treasurer"},
    {from: "Treasurer", to: "SP2"},
    {from: "SP2", to: "Treasurer"}, //8:6
    {from: "Treasurer", to: "SP2"},
    {from: "SP2", to: "SP1"},
    {from: "SP1", to: "Treasurer"}, //8:7
    {from: "Treasurer", to: "SP2"}, 
    {from: "SP2", to: "SP1"},
    {from: "SP1", to: "Treasurer"} //8:8
  ]; 

  if (condition == 1) schedule = schedule_condition_1;
  if (condition == 2) schedule = schedule_condition_2;
  if (condition == 3) schedule = schedule_condition_3;
  if (condition == 4) schedule = schedule_condition_4;
  jsPsych.data.addProperties({ schedule: condition });
  console.log("Condition is: ", condition);

  function getRulesByCondition(condition){
    switch (condition) {
      case 1:
        return  `<li>You are SP1.</li>
                <li>You earn points by tossing the ball to the Treasurer.</li> 
                <li>The person who tossed the ball will earn 1 point.</li>
                <li>Each point you earn is worth $0.05.</li>`;
      case 2:
        return  `<li>You are SP1.</li>
                <li>You earn points by tossing the ball to the Treasurer.</li> 
                <li>The person who tossed the ball will earn 1 point.</li>
                <li>Each point you earn is worth $0.05.</li>
                <li>Passing between SP1 and SP2 is NOT allowed.</li>`;
      case 3:
        return  `<li>You are SP1.</li>
                <li>You earn points by tossing the ball to the Treasurer.</li> 
                <li>The person who tossed the ball will earn 1 point.</li>
                <li>Each point you earn is worth $0.05.</li>
                <li>Passing between SP1 and SP2 is allowed, but no points will be awarded for those throws.</li>`;
      case 4:
        return  `<li>You are SP1.</li>
                <li>You earn points by tossing the ball to the Treasurer.</li> 
                <li>The person who tossed the ball will earn 1 point.</li>
                <li>Each point you earn is worth $0.05.</li>
                <li>Passing between SP1 and SP2 is allowed, but no points will be awarded for those throws.</li>`;
      default:
        return `<p>Error: Invalid condition.</p>`;
    }
  }

  //switch to fullscreen >> TO DO https://www.jspsych.org/v7/plugins/fullscreen/#__tabbed_1_1

  //----CREATE TRIAL FUNCTIOn ----//


 function throw_trial(throw_object){
    const isParticipant = throw_object.from == "SP1"; // check if from = SP1

    if (isParticipant) {
        return { //participant has ball 
            type: jsPsychHtmlKeyboardResponse,
            stimulus: cyberball_display.stimulus,
            choices: "NO_KEYS",
            on_load: function() {
                const treasurerElem = document.getElementById("Treasurer");
                treasurerElem.classList.add("highlight-clickable");
                treasurerElem.style.cursor = "pointer"; 
                treasurerElem.onclick = () => {
                    animateThrowFrames("SP1", "Treasurer", () => {
                    treasurerElem.classList.remove("highlight-clickable");
                    jsPsych.finishTrial({from: "SP1", to: "Treasurer"});
                    });

                };
                if (condition > 2) {
                    const sp2Elem = document.getElementById("SP2");
                    sp2Elem.classList.add("highlight-clickable");
                    sp2Elem.style.cursor = "pointer";
                    sp2Elem.onclick = () => {
                        animateThrowFrames("SP1", "SP2", () => {
                        treasurerElem.classList.remove("highlight-clickable");
                        sp2Elem.classList.remove("highlight-clickable");
                        jsPsych.finishTrial({from: "SP1", to: "SP2"})
                        });
                    };
                }
            }
        };
            
    } else {
        // Automated bot throw
        return {
            type: jsPsychHtmlKeyboardResponse,
  stimulus: cyberball_display.stimulus,
  choices: "NO_KEYS",
  trial_duration: null,
  on_load: function() {
    const pause = randomPause(1000, 3000);

    setTimeout(() => {
      animateThrowFrames(throw_object.from, throw_object.to, () => {
        jsPsych.finishTrial({
          from: throw_object.from,
          to: throw_object.to
        });
      });
    }, pause);
  }
};
    }
};


//create timeline 
//disable popup button until instructions done
document.getElementById("rulesBtn").style.display = "none";   // hide

//generate subject id and prolific information here -- TO DO

//Consent for here 
//consent form
  var consent ={
    type: jsPsychHtmlButtonResponse,
    stimulus: `
    <p style = "text-align: start; width: 900px"> You are being invited to participate in a research study titled: The Influence of Social Interactions on Decision Making.<br><br>
        This study is being done by Michael McCullough, PhD (Principal Investigator) from UC San Diego. You were selected to participate in this study because you are a representative member of the society the investigators wish to study. 
        The purpose of this research study is to explore how nonverbal social interactions affect the way people talk to themselves. Your participation in this research should last no longer than 30 minutes. If you agree to take part in this study, you will be asked to complete several surveys that ask about your feelings, beliefs, judgments, and personal background.
        Your participation in this study is completely voluntary and you can withdraw at any time. Choosing not to participate or withdrawing will result in no penalty or loss of benefits to which you are entitled. Research sometimes requires that information regarding its purpose not be shared with the research participants because its knowledge could impact the results of the research. 
        Note that none of the aspects of the research being withheld are reasonably expected to affect your willingness to take part. While the tasks you will be asked to perform for this research have been explained, the full intent of the research will not be provided until the completion of the study. At that time, you will have the opportunity to ask questions, including about the purpose of the study and the procedures used, and withdraw your data if you so choose.
        If you have questions about this project or if you have a research-related problem, you may contact the researcher(s), Michael McCullough, Ph.D., Department of Psychology, University of California, San Diego, 9500 Gilman Drive, La Jolla, CA 92093-0109 and by email at memccullough@ucsd.edu. If you have any questions concerning your rights as a research subject, you may contact the UC San Diego Office of IRB Administration at irb@ucsd.edu or 858-246-4777.
        By participating in this research, you are indicating that you are at least 18 years old, have read this consent form, and agree to participate in this research study. Please keep this consent form for your records.</p>
        <p>Do you consent?</p>`,
    choices: ['I Consent', 'I Do Not Consent'],
    data: { task: 'consent' },
    on_finish: function(data){
      if(data.response === 1){
        jsPsych.data.addProperties({ reason: "participant_declined_consent" }); //log reason for non-consent
        
        document.body.innerHTML = `
        <div style="text-align:center; margin-top:100px;">
          <h3>You have chosen not to participate in this study.</h3>
          <p>Thank you for your time. You may now close this window.</p>
          <p>Or, you will be automatically redirected in 5 seconds.</p>
        </div>
      `;

      // delay redirect
      setTimeout(function() {
        window.location.href = "https://irb.ucsd.edu/participants/index.html";
      }, 5000);

      // return false prevents jsPsych from continuing the timeline
      return false;
    }
  }
};
timeline.push(consent);

// study description 
    var study_description = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<h2>Study Description</h2>
                 <p style="width: 900px; text-align: start">Thank you for agreeing to participate in this study! This study seeks to understand how social interactions influence our decision-making processes.<br><br>
                 In this study, you will play a virtual ball-tossing game with two other participants. The game is designed to simulate social interactions and observe how they affect how you make decisions towards other people.<br><br>
                 The instructions for the game will be provided in the next section. To ensure that everyone understands the rules, there will be a short quiz. If you get any answers wrong, don't worry‚Äîyou will have the opportunity to review the instructions and retake the quiz until you get all the answers correct.<br><br>
                 Please pay close attention to the game and try to engage with the other participants as naturally as possible.</p>`,
        choices: ['Continue'],
        data: { task: 'study_description' }
    };
    timeline.push(study_description);

//instructions 
    var game_instructions = {
        type: jsPsychHtmlButtonResponse,
        stimulus: function() {
            if (condition == 1){
                return `<h2>Game Instructions</h2>
                <p style="width: 1000px; text-align: start">In Cyberball there are three players: Standard Player 1 (SP1), Standard Player 2 (SP2), and a Treasurer. <b>You are SP1</b>.
                <br><br>
                Your objective in Cyberball is to earn points by tossing a ball. At the end of the game, the points will be converted into a monetary bonus. Each point you earn is worth $0.05. To help you keep track of points, there will be a scoreboard displayed in the top-right corner of the screen during the game.
                <br><br>
                The way the game works is that SP1 and SP2 individually earn points by tossing the ball to the Treasurer. Each time that SP1 or SP2 tossed the ball to the Treasurer, <u>the person who tossed the ball earns one point</u>. In other words, SP1 and SP2 earn points when they get the chance to toss the ball to the Treasurer.
                So, for example, if SP1 tosses the ball to the Treasurer, SP1 will earn one point and SP2 will not earn any points. Likewise, if SP2 tosses the ball to the Treasurer, SP2 will earn one point and SP1 will not earn anything. 
                <br><br>
                Keep in mind that SP1 and SP2 cannot earn points by tossing the ball to each other. SP1 and SP2 can only earn points by tossing the ball to the Treasurer.</p>`; //condition 1 instructions here (equitable treasurer)
            }
            else if (condition == 2){
                return `<h2>Game Instructions</h2>
                <p style="width: 1000px; text-align: start">In Cyberball there are three players: Standard Player 1 (SP1), Standard Player 2 (SP2), and a Treasurer. <b>You are SP1</b>.
                    <br><br>
                    Your objective in Cyberball is to earn points by tossing a ball. At the end of the game, the points will be converted into a monetary bonus. Each point you earn is worth $0.05. To help you keep track of points, there will be a scoreboard displayed in the top-right corner of the screen during the game.<br>
                    <br>
                    The way the game works is that SP1 and SP2 individually earn points by tossing the ball to the Treasurer. Each time that SP1 or SP2 tossed the ball to the Treasurer, <u>the person who tossed the ball earns one point</u>. In other words, SP1 and SP2 earn points when they get the chance to toss the ball to the Treasurer.  
                    So, for example, if SP1 tosses the ball to the Treasurer, SP1 will earn one point and SP2 will not earn any points. Likewise, if SP2 tosses the ball to the Treasurer, SP2 will earn one point and SP1 will not earn anything. 
                    In this game, you are only allowed to pass the ball to the Treasurer. SP1 and SP2 are <b>not allowed</b> to pass the ball back and forth to each other.
                    <br><br>
                    <b>Keep in mind that SP1 and SP2 are not allowed to pass the ball to each other. You may only pass to the Treasurer.</b></p>`; //condition 2 instructions here (inequitable treasurer, no passing)
                }
                else if (condition == 3){
                return `<h2>Game Instructions</h2>
                <p style="width: 1000px; text-align: start">In Cyberball there are three players: Standard Player 1 (SP1), Standard Player 2 (SP2), and a Treasurer. <b>You are SP1</b>.
                <br><br>
                Your objective in Cyberball is to earn points by tossing a ball. At the end of the game, the points will be converted into a monetary bonus. Each point you earn is worth $0.05. To help you keep track of points, there will be a scoreboard displayed in the top-right corner of the screen during the game.<br>
                <br>
                The way the game works is that SP1 and SP2 individually earn points by tossing the ball to the Treasurer. Each time that SP1 or SP2 tossed the ball to the Treasurer, <u>the person who tossed the ball earns one point</u>. In other words, SP1 and SP2 earn points when they get the chance to toss the ball to the Treasurer. Of course, you could toss the ball to whomever you want, but you will only earn points when you pass the ball to the Treasurer.
                So, for example, if SP1 tosses the ball to the Treasurer, SP1 will earn one point and SP2 will not earn any points. Likewise, if SP2 tosses the ball to the Treasurer, SP2 will earn one point and SP1 will not earn anything. 
                <br><br>
                Keep in mind that SP1 and SP2 cannot earn points by tossing the ball to each other.
                SP1 and SP2 can only earn points by tossing the ball to the Treasurer. So, for example, if SP1 tosses the ball to SP2, neither SP1 or SP2 will earn any points. But whoever then throws the ball to the Treasurer will earn a point.</p>`; //condition 3 instructions here (inequitable treasurer, passing allowed but not used)
            }
            else if (condition == 4){
                return `<h2>Game Instructions</h2>
                <p style="width: 1000px; text-align: start">In Cyberball there are three players: Standard Player 1 (SP1), Standard Player 2 (SP2), and a Treasurer. <b>You are SP1</b>.
                <br><br>
                Your objective in Cyberball is to earn points by tossing a ball. At the end of the game, the points will be converted into a monetary bonus. Each point you earn is worth $0.05. To help you keep track of points, there will be a scoreboard displayed in the top-right corner of the screen during the game.<br>
                The way the game works is that SP1 and SP2 individually earn points by tossing the ball to the Treasurer. Each time that SP1 or SP2 tossed the ball to the Treasurer, <u>the person who tossed the ball earns one point</u>. In other words, SP1 and SP2 earn points when they get the chance to toss the ball to the Treasurer. Of course, you could toss the ball to whomever you want, but you will only earn points when you pass the ball to the Treasurer.
                So, for example, if SP1 tosses the ball to the Treasurer, SP1 will earn one point and SP2 will not earn any points. Likewise, if SP2 tosses the ball to the Treasurer, SP2 will earn one point and SP1 will not earn anything. 
                <br><br>
                Keep in mind that SP1 and SP2 cannot earn points by tossing the ball to each other.
                SP1 and SP2 can only earn points by tossing the ball to the Treasurer. So, for example, if SP1 tosses the ball to SP2, neither SP1 or SP2 will earn any points. But whoever then throws the ball to the Treasurer will earn a point.</p>`; //condition 4 instructions here (inequitable treasurer, passing allowed and used)
            }

        },
        choices: ['Continue'],
        enable_button_after: 5000, // prevent skipping too quickly
        data: { task: 'game_instructions' },
        
    };


// comprehension quiz 
  var comprehension_quiz = {
    type: jsPsychSurveyMultiChoice,
    questions: [
      {
        prompt: "<p>What is your role in the game?</p>",
        name: "role",
        options: ["Treasurer", "Standard Player 1 (SP1)", "Standard Player 2 (SP2)"],
        required: true,
        horizontal: false
      },
      {
        prompt: "<p>How do you earn points in the game?</p>",
        name: "points",
        options: [
          "By tossing the ball to the Treasurer",
          "By tossing the ball to Standard Player 2 (SP2)",
          "By catching the ball"
        ],
        required: true,
        horizontal: false
      },
      {
        prompt: "<p>Are you allowed to toss the ball to Standard Player 2 (SP2)?</p>",
        name: "passing",
        options: ["Yes", "No"],
        required: true,
        horizontal: false
      },
      {
        prompt: "<p>How many points do you earn after passing to Standard Player 2 (SP2)?</p>",
        name: "passing_points",
        options: ["0 points", "1 point", "Not allowed to pass to SP2"],
        required: true,
        horizontal: false
      }

    ],
    data: { task: 'comprehension_quiz' },
    on_finish: function(data){
      const responses = data.response;
      let correct = true;

      if(responses.role !== "Standard Player 1 (SP1)") correct = false;
      if(responses.points !== "By tossing the ball to the Treasurer") correct = false;
      if(condition === 2 && responses.passing !== "No") correct = false;
      if(condition !== 2 && responses.passing !== "Yes") correct = false;
      if(condition === 2 && responses.passing_points !== "Not allowed to pass to SP2") correct = false;
      if(condition !== 2 && responses.passing_points !== "0 points") correct = false

      data.correct = correct;
    }
  };

  var quiz_fail_feedback = {
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){
    //get the last quiz data (aka correctness of last quiz)
    const lastQuiz = jsPsych.data.get().filter({task: 'comprehension_quiz'}).last(1).values()[0];

    if(!lastQuiz.correct){
      return `
    <p style="color:red; font-weight:bold;">
      Some of your answers were incorrect.
    </p>
    <p>Please re-read the instructions and try again.</p>`;
  }
  else{
    return `<p style="color:green; font-weight:bold">Great! You have answered all questions correctly. Let's move on to the game.</p><p>If you need a refresh on the instructions, please click the button <i>Open Cyberball Rules</i> on the top left corner of your screen.</p>`;
  }
  },
  choices: ['Continue'],
};

var instructions_and_quiz = {
  timeline: [
    game_instructions,
    comprehension_quiz,
    quiz_fail_feedback
  ],
  loop_function: function(data){
    // get last quiz trial
    const lastQuiz = data.filter({task: 'comprehension_quiz'}).last(1).values()[0];

    if (!lastQuiz.correct) {
      return true; // repeat the timeline
    } else {
      return false; // exit the loop
    }
  }
};
timeline.push(instructions_and_quiz);

var enable_rules_button = {
  type: jsPsychCallFunction,
  func: function(){
    document.getElementById("rulesBtn").style.display = "block";
    document.getElementById("rulesBtn").disabled = false;

    document.getElementById("rulesText").innerHTML =
      getRulesByCondition(condition);
  }
};

timeline.push(enable_rules_button);
var enable_scoreboard = {
  type: jsPsychCallFunction,
  func: function() {
    const sb = document.getElementById("scoreboard");
    sb.style.display = "block";  // make it visible
  }
};
timeline.push(enable_scoreboard);

//cyberball game below 
  for (let i = 0; i < schedule.length; i++){
    timeline.push(throw_trial(schedule[i]));
  }

// popup for the instructions
  function popupFn(){
    document.getElementById("overlay").style.display = "block";
    overlay.style.pointerEvents = "auto";
    document.getElementById("popupDialog").style.display = "block";
  }

  function closeFn(){
    document.getElementById("overlay").style.display = "none";
    overlay.style.pointerEvents = "none";
    document.getElementById("popupDialog").style.display = "none";
  }

//function for points to money conversion 
  function pointsToDollars(points) {
    const conversionRate = 0.05; // $0.05 per point
    return (points * conversionRate).toFixed(2); // returns a string with 2 decimal places
  }
//formal end of game screen 
  var end_game = {
    type: jsPsychHtmlButtonResponse,
    stimulus: function() {
      //get points data 
      const sp1Data = jsPsych.data.get().filter({from: "SP1", to: "Treasurer"});
      const sp1Points = sp1Data.count();
      const sp2Data = jsPsych.data.get().filter({from: "SP2", to: "Treasurer"});
      const sp2Points = sp2Data.count();

      sp1Dollars = pointsToDollars(sp1Points);
      sp2Dollars = pointsToDollars(sp2Points);

      return `<h2>Game Over</h2>
              <p style="width: 800px; text-align: start;">The game has ended! You earned <b>${sp1Points} points</b>, which is equivalent to <b>$${sp1Dollars}</b>.<br><br>
                Your fellow player, Standard Player 2, earned <b>${sp2Points} points</b>, which is equivalent to <b>$${sp2Dollars}</b>.<br><br>
                Please click the button below to continue to the next part of the study.</p>`;
    },
    choices: ['Continue'],
    data: { task: 'end_game' }, 
    on_finish: function(){
      const sp1Data = jsPsych.data.get().filter({from: "SP1", to: "Treasurer"});
      const sp1Points = sp1Data.count();
      const sp2Data = jsPsych.data.get().filter({from: "SP2", to: "Treasurer"});
      const sp2Points = sp2Data.count();

      sp1Dollars = pointsToDollars(sp1Points);
      sp2Dollars = pointsToDollars(sp2Points);
      //store points and $ amounts in data
      jsPsych.data.addProperties({
        sp1Points: sp1Points,
        sp1Dollars: sp1Dollars,
        sp2Points: sp2Points,
        sp2Dollars: sp2Dollars
      });
    }
  };
  timeline.push(end_game);


//comprehension check 
var comprehension_check = {
    type: jsPsychSurveyText, 
    questions: [
      {prompt:"<p>How many times did you receive the ball from the Treasurer? If you are unsure, please just tell us your best estimate.</p>", name: "SP1_ball_received_T"},
      {prompt:"<p>How many times did you receive the ball from SP2? If you are unsure, please just tell us your best estimate.</p>", name: "SP1_ball_received_SP2"},
      {prompt:"<p>How many times did SP2 receive the ball from the Treasurer? If you are unsure, please just tell us your best estimate.</p>", name: "SP2_ball_received_T"},
    ],
    data: { task: 'comprehension_check'},
    //condition Q2 to only show if condition > 2 
    on_start: function(trial){
      if (condition <= 2){
        trial.questions = trial.questions.filter(q => q.name !== "SP1_ball_received_SP2");
      }
    },
    on_finish: function(data){
      var responses = data.response;
      //disable rules button after comprehension check
      document.getElementById("rulesBtn").style.display = "none";   // hide
      jsPsych.data.addProperties({
        SP1_ball_received_T: responses.SP1_ball_received_T,
        SP1_ball_received_SP2: responses.SP1_ball_received_SP2,
        SP2_ball_received_T: responses.SP2_ball_received_T
      });
    }
};
timeline.push(comprehension_check);

//money burning task 
function renderCoins(containerId, amount) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  const coinHeight = 10;
  amount = Math.max(0, Number(amount)); // ensure non-negative and make numeric 

  for (let i = 0; i < amount; i++) {
    const coin = document.createElement("div");
    coin.style.width = "60px";
    coin.style.height = coinHeight + "px";
    coin.style.borderRadius = "50%";
    coin.style.background = "#f5c542";
    coin.style.border = "1px solid #b58b1e";
    coin.style.marginTop = "-6px"; // overlap coins
    container.appendChild(coin);
  }
}


// burn at a 1:5 ratio 
var dv1_money_burning = {
  type: jsPsychHtmlSliderResponse,
  //render visualization of coins 
  on_load: function() {
  setTimeout(() => {
    const display = jsPsych.getDisplayElement();
    const slider = display.querySelector("input[type='range']");

    //get amounts from CB game for the visualization
    const sp1Delta = display.querySelector("#sp1-delta");
    const sp2Delta = display.querySelector("#sp2-delta");

    const MAX_SP1 = treasurerThrowCount_SP1 * 5; // example if sp1 points = 4 then money = $0.20 
    const MAX_SP2 = treasurerThrowCount_SP2 * 5; // example if sp2 points = 8 then money = $0.40
    const RATIO = 5; // 1:5 sacrifice ratio
    

    function updateViz(sacrifice) {
        sacrifice = Math.max(0, Number(sacrifice)); // force number >= 0

        const sp1Loss = Math.min(sacrifice, MAX_SP1); // example if sp1 sacrifices $0.03 then sp1Loss = $0.03
        const sp2Loss = Math.min(sp1Loss * RATIO, MAX_SP2); // example if sp1 sacrifices $0.03 then sp2 loses $0.15


        const sp1Remaining = MAX_SP1 - sp1Loss; // example if Max = $0.20 and sp1Loss = $0.03 then remaining = $0.17
        const sp2Remaining = MAX_SP2 - sp2Loss;

        renderCoins("sp1-coins", Math.round(sp1Remaining)); // example if sp1Remaining = $0.17 then render 17 coins
        renderCoins("sp2-coins", Math.round(sp2Remaining));

        const sp1Base = display.querySelector("#sp1-baseline");
        const sp2Base = display.querySelector("#sp2-baseline");

        //base should be updated to show remaining $ --> these are cents not dollars 
        sp1Base.textContent = `$${(sp1Remaining / 100).toFixed(2)}`; //output example: $0.17
        sp2Base.textContent = `$${(sp2Remaining / 100).toFixed(2)}`;
      }

      // Initialize display
      updateViz(slider.value);

    slider.addEventListener("input", function () {
      updateViz(this.value);
    });
  }, 0);
},
  stimulus: `
  <p style="width: 1000px; padding: 10px">
    You may choose to reduce SP2‚Äôs earnings by giving up some of your own earnings. This is a <u>one-time, one-sided decision</u>. This means only you make this decision; SP2 will not make a corresponding decision.<br><br>

    For every <b>$0.01</b> you give up, SP2‚Äôs earnings are reduced by <b>$0.05</b>.<br>
    For example, giving up <b>$0.03</b> reduces SP2‚Äôs earnings by <b>$0.15</b>. Choosing $0 means no change to either participant's earnings.<br>
    Earnings for either participant cannot go below <b>$0</b>.<br><br>

    You may move the slider below to see how different choices would affect both participants‚Äô earnings. Moving the slider does not finalize your decision. Your decision is only locked in once you click 'Continue' and move on to the next task.<br><br>

    There is no correct or expected choice. Please use the slider to indicate how much of your own earnings you would like to give up in order to reduce SP2's earnings.
    </p>

  <div style="
    display:flex;
    justify-content:center;
    gap:100px;
    margin:30px 0;
    align-items:flex-end;
  ">

    <div style="text-align:center;">
      <div id="sp1-baseline" style="font-weight: bold; margin-bottom:6px;">$${(treasurerThrowCount_SP1/100).toFixed(2)}</div>
      <div id="sp1-coins"></div>
      <div style="margin-top:6px;">You (SP1)</div>
    </div>

    <div style="text-align:center;">
      <div id="sp2-baseline" style="font-weight: bold; margin-bottom:6px;">$${(treasurerThrowCount_SP2/100).toFixed(2)}</div>
      <div id="sp2-coins"></div>
      <div style="margin-top:6px;">SP2</div>
    </div>

  </div>
  `
  ,
  labels: ["0", "1", "2", "3", "4", "5","6","7","8","9","10","11","12"],
  min: 0,
  max: 12,
  step: 1, 
  slider_start: 0,
  slider_width: 1000,
  on_finish: function(data){
    var burn_amount = data.response;
    jsPsych.data.addProperties({ burn_amount: burn_amount });
    //update the scoreboard 
    
  },
};
timeline.push(dv1_money_burning);

//disable scoreboard after money burning task
var disable_scoreboard = {
  type: jsPsychCallFunction,
  func: function() {
    const sb = document.getElementById("scoreboard");
    sb.style.display = "none";  // hide it
  }
};
timeline.push(disable_scoreboard);

var d1_open_ended = {
  type: jsPsychSurveyText,
  preamble: `
  <div style="top: 0; background-color: white; border-bottom: 2px solid #ddd; z-index: 100;">
  <p>We would like for you to reflect on how you experienced Cyberball and your interactions with the other two players. Please respond to the following prompts. We‚Äôll ask you to write at least 50 words in response to each prompt. As you write, please do not include any words to describe your emotions. For example, try not to use words such as ‚Äúhappy,‚Äù ‚Äúsad,‚Äù ‚Äúsurprised,‚Äù or ‚Äúafraid‚Äù in your responses. Instead, focus on describing your thoughts and impressions in detail.</p><br><br>
  </div>
  <div style="margin-top: 10px;">
  `,
  questions: [
    {
      prompt: `
        <p style="text-align: start; padding: 10px; left-margin: 10px">
        <br>
        Are you satisfied with how the game went for you? If so, why? If not, why?<br><br>

        Please explain your answer.
        </p>
        <div id="wordcount_SP2" style="font-size:0.9em; color:#555;">
          Word count: 0
        </div>`,
      name: "dv1_OE_game_satisfaction",
      rows: 5,
      columns: 100,
      required: true
    }, 
    {
      prompt: `
        <p style="text-align: start; padding: 10px; left-margin: 10px">
        <br>
        Are you satisfied with how much you got to play?<br><br>

        Please explain your answer.
        </p>
        <div id="wordcount_playtime" style="font-size:0.9em; color:#555;">
          Word count: 0
        </div>
        `,
      name: "dv1_oe_playtime_satisfaction",
      rows: 5,
      columns: 100,
      required: true
    },
    {
      prompt: `
        <p style="text-align: start; padding: 10px; left-margin: 10px">
        <br>
        Are you satisfied with how much money you made?<br><br>

        Please explain your answer.
        </p>
        <div id="wordcount_money" style="font-size:0.9em; color:#555;">
          Word count: 0
        </div>
        `,
      name: "dv1_oe_earnings_satisfaction",
      rows: 5,
      columns: 100,
      required: true
    },
    {
      prompt: `
        <p style="text-align: start; padding: 10px; left-margin: 10px">
        <br>
        What do you think about the behavior of the treasurer during the game? Do you like how they behaved, or do you dislike it? Did it meet your expectations? Is there anything you wish they had done differently?<br><br>

        Please explain your answer.
        </p>
        <div id="wordcount_Treasurer_bx" style="font-size:0.9em; color:#555;">
          Word count: 0
        </div>
        `,
      name: "dv1_oe_treasurer_behavior",
      rows: 5,
      columns: 100,
      required: true
    },
    {
      prompt: `
        <p style="text-align: start; padding: 10px; left-margin: 10px">
        <br>
        What do you think about the behavior of SP2 during the game? Do you like how they behaved, or do you dislike it? Did it meet your expectations? Is there anything you wish they had done differently?<br><br>

        Please explain your answer.
        </p>
        <div id="wordcount_SP2_bx" style="font-size:0.9em; color:#555;">
          Word count: 0
        </div>
        `,
      name: "dv1_oe_sp2_behavior",
      rows: 5,
      columns: 100,
      required: true
    },
    {
      prompt: `
        <p style="text-align: start; padding: 10px; left-margin: 10px">
        <br>
        If you could speak to the Treasurer describing your reactions to how they played the game and how it affected you, what would you say?
        </p>
        <div id="wordcount_message_to_treasurer" style="font-size:0.9em; color:#555;">
          Word count: 0
        </div>
        `,
      name: "dv1_oe_message_to_treasurer",
      rows: 5,
      columns: 100,
      required: true
    },
    {
      prompt: `
        <p style="text-align: start; padding: 10px; left-margin: 10px">
        <br>
        If you could speak to SP2 describing your reactions to how they played the game and how it affected you, what would you say?
        </p>
        <div id="wordcount_message_to_sp2" style="font-size:0.9em; color:#555;">
          Word count: 0
        </div>
        `,
      name: "dv1_oe_message_to_sp2",
      rows: 5,
      columns: 100,
      required: true
    },
  ],
  on_load: function() {
  const MIN_WORDS = 50;

  const waitForElements = setInterval(() => {
    const textareas = document.querySelectorAll("textarea");
    const counters = document.querySelectorAll("[id^='wordcount_']");
    const nextButton = document.querySelector(".jspsych-btn");

    if (textareas.length > 0 && textareas.length === counters.length && nextButton) {
      clearInterval(waitForElements);

      nextButton.disabled = true;

      const countWords = (text) =>
        text.trim().split(/\s+/).filter(w => w.length > 0).length;

      const updateCounters = () => {
        let allValid = true;

        textareas.forEach((textarea, i) => {
          const words = countWords(textarea.value);
          const counter = counters[i];

          counter.innerHTML = `Word count: ${words} / ${MIN_WORDS}`;

          if (words < MIN_WORDS) {
            counter.style.color = "darkred";
            allValid = false;
          } else {
            counter.style.color = "green";
          }
        });

        nextButton.disabled = !allValid;
      };

      // üî¥ THIS is what makes it update live
      textareas.forEach(textarea => {
        textarea.addEventListener("input", updateCounters);
      });

      // Run once on load
      updateCounters();
    }
  }, 50);
}

}

timeline.push(d1_open_ended);

// actions list 
var dv2_actions = {
  type: jsPsychSurveyLikert,
  preamble: `
  <div style="position: fixed; top: 0; background-color: white; padding: 10px; width: 800px; border-bottom: 2px solid #ddd; z-index: 100;">
  <p>For the set of questions below, we would like you to imagine how you might feel, think, and behave <b>towards SP2</b> if you encountered them in the future. Select the choice that most aligns.</p>
  </div>
  <div style="margin-top: 80px;">
  `,
  questions: [
    {
      prompt: "<p>Praising the person to others</p>",
      name: "dv2_praising",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Insulting the person</p>",
      name: "dv2_insulting",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Avoiding the person</p>",
      name: "dv2_avoiding",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Becoming friends with the person</p>",
      name: "dv2_become_friends",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt:"<p>Saying unkind things about the person to others</p>",
      name: "dv2_unkind_things",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Helping the person if they needed help</p>",
      name: "dv2_helping",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Complimenting the person</p>",
      name: "dv2_complementing",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Doing a favor for the person</p>",
      name: "dv2_favor",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Inviting the person to do something fun</p>",
      name: "dv2_invite_fun",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Ignoring the person</p>",
      name: "dv2_ignore",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
  ],
};
timeline.push(dv2_actions);

//dv3 state envy
var dv3_state_emotions = {
  type: jsPsychSurveyLikert,
  preamble: `
  <div style="position: fixed; top: 0; background-color: white; padding: 10px; width: 800px; border-bottom: 2px solid #ddd; z-index: 100;">
  <p>For the list below, please indicate which of these emotions you <b>feel towards SP2</b>.</p>
  </div>
  <div style="margin-top: 80px;">
  `,
  questions: [
    {
      prompt: "<p>Evious</p>",
      name: "dv3_state_envy",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Jealous</p>",
      name: "dv3_state_jealous",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true  
    },
    {
      prompt: "<p>Bitter</p>", 
      name: "dv3_state_bitter",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Resentful</p>",
      name: "dv3_state_resentful",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Happy</p>",
      name: "dv3_state_happy",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Compassionate</p>",
      name: "dv3_state_compassionate",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>Surprised</p>", 
      name: "dv3_state_surprised",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Grateful</p>", 
      name: "dv3_state_grateful",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Thankful</p>", 
      name: "dv3_state_thankful",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Sad</p>", 
      name: "dv3_state_sad",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Upset</p>", 
      name: "dv3_state_upset",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Disappointed</p>",
      name: "dv3_state_disappointed",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Annoyed</p>",
      name: "dv3_state_annoyed",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Angry</p>",
      name: "dv3_state_angry",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Shame</p>", 
      name: "dv3_state_shame",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Contempt</p>", 
      name: "dv3_state_contempt",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Joy</p>", 
      name: "dv3_state_joy",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Irritated</p>", 
      name: "dv3_state_irritated",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }
  ],
}; 
timeline.push(dv3_state_emotions);

var dv3a_game_feelings ={
  type: jsPsychSurveyLikert,
  preamble: `
  <div style="position: fixed; top: 0; background-color: white; padding: 10px; width: 800px; border-bottom: 2px solid #ddd; z-index: 100;">
  <p>Please respond to the following statements by selecting the choice that reflects how you <b>feel about the game</b>.</p>
  </div>
  <div style="margin-top: 80px;">
  `, 
  questions: [
    {
      prompt: "<p>I feel like the game was unfair</p>",
      name: "dv3a_game_unfair",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I was happy with the results of the game</p>",
      name: "dv3a_results_happy",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I wish the game had gone differently</p>",
      name: "dv3a_game_different",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I wish that I had received the ball more times that I did</p>",
      name: "dv3a_wish_received_more",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>I was ignored</p>", 
      name: "dv3a_felt_ignored",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>Select <i>Disagree Moderately</i> for this question</p>",
      name: "dv3a_attention_check_1",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I was socially excluded</p>", 
      name: "dv3a_felt_excluded",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I felt a bit maliciously envious of the players", 
      name: "dv3a_felt_malicious_envy",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p> I understood the rules of the game</p>",
      name: "dv3a_understood_rules",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p> I think I performed well in the game </p>",
      name: "dv3a_performed_well",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {prompt: "<p>I felt bad for the other players because I did better than them</p>",
      name: "dv3a_felt_bad_others",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }
  ], 
  randomize_question_order: true
}
timeline.push(dv3a_game_feelings);

var dv3b_player_feelings_sp2 = {
  type: jsPsychSurveyLikert,
  preamble: `
  <div style="position: fixed; top: 0; background-color: white; padding: 10px; width: 800px; border-bottom: 2px solid #ddd; z-index: 100;">
  <p>Please respond to the following statements by selecting the choice that reflects how you <b>feel about SP2</b>.</p>
  </div>
  <div style="margin-top: 80px;">
  `,
  questions: [
    {
      prompt: "<p>I feel a sense of closeness towards SP2</p>",
      name: "dv3b_sp2_closeness",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I feel betrayed by SP2</p>",
      name: "dv3b_sp2_betrayal",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>SP2 was unfair during the game</p>",
      name: "dv3b_sp2_unfiar",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I want to take the winning of SP2</p>",
      name: "dv3b_sp2_take_winnings",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I think that SP2 deserved the earnings they received.</p>",
      name: "dv3b_sp2_deservingness",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I felt like I was in competition with SP2.</p>",
      name: "dv3b_sp2_competition",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>SP2 and I shared similar goals in the game.</p>",
      name: "dv3b_sp2_shared_goals",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I felt like SP2 was my rival</p>",
      name: "dv3b_sp2_rival",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }
  ], 
  randomize_question_order: true
};
timeline.push(dv3b_player_feelings_sp2);

dv3c_player_feelings_treasurer = {
  type: jsPsychSurveyLikert,
  preamble: `
  <div style="position: fixed; top: 0; background-color: white; padding: 10px; width: 800px; border-bottom: 2px solid #ddd; z-index: 100;">
  <p>Please respond to the following statements by selecting the number that reflects how you <b>feel about the Treasurer</b>.</p>
  </div>
  <div style="margin-top: 80px;">
  `,
  questions: [
    {
      prompt: "<p>I feel a sense of closeness towards the Treasurer</p>",
      name: "dv3c_treasurer_closeness",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I feel betrayed by the Treasurer</p>",
      name: "dv3c_treasurer_betrayal",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>The Treasurer was unfair during the game</p>",
      name: "dv3c_treasurer_unfair",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I felt like I was in competition with Treasurer.</p>",
      name: "dv3b_treasurer_competition",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>The Treasurer and I shared similar goals in the game.</p>",
      name: "dv3b_treasurer_shared_goals",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I felt like the Treasurer was my rival</p>",
      name: "dv3b_treasurer_rival",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }
  ], 
  randomize_question_order: true
}; 
timeline.push(dv3c_player_feelings_treasurer);

var dv4_trait_envy_york = {
  type: jsPsychSurveyLikert,
  preamble: `
  <div style="position: fixed; top: 0; background-color: white; padding: 10px; width: 800px; border-bottom: 2px solid #ddd; z-index: 100;">
  <p>Please respond to the following statements by selecting the number that reflects how you generally tend to feel.</p>
  </div>
  <div style="margin-top: 80px;">
  `,
  questions: [
    {
      prompt: `<p>It makes me feel good to ‚Äúrain on someone‚Äôs parade"</p>`,
      name: "dv4_rain_on_parade",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>I wouldn‚Äôt want to trade places with anyone.</p>",
      name: "dv4_trade_places_rev",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    },
    {
      prompt: "<p>I feel angry when others succeed.</p>",
      name: "dv4_angry_others_succeed",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>It brings me happiness to see my friends succeed.</p>",
      name: "dv4_happy_friends_succeed_rev",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I‚Äôm content with what I‚Äôve got.</p>",
      name: "dv4_content_with_self_rev",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true  
    }, 
    {
      prompt: "<p>I am happy when others succeed even when I don‚Äôt.</p>",
      name: "dv4_happy_others_succeed_rev",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>It pains me to think of the success of my friends.</p>",
      name: "dv4_pain_friends_succeed",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }, 
    {
      prompt: "<p>I would rather see someone I don‚Äôt know win a lottery than to see an acquaintance win.</p>",
      name: "dv4_prefer_stranger_win",
      labels: ["Disagree Strongly", "Disagree Moderately", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Agree Moderately", "Agree Strongly"],
      required: true
    }
  ], 
  randomization_question_order: true, 
}; 
timeline.push(dv4_trait_envy_york);

var demographics = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {
      prompt: "<p>How many meals have you had in your life?</p>",
      name: "demo_attention_check_2",
      options: ["1", "10", "100", "1000+"],
      required: true,
      horizontal: false
    },
    {
      prompt: "<p>Please select the term below that best describes your sex identity?</p>",
      name: "demo_sex", 
      options: ["Male", "Female", "I prefer not to answer"],
      required: true,
      horizontal: false
    }, 
    {
      prompt: "<p>Please select the term below that best describes your gender identity?</p>",
      name: "demo_gender",
      options: ["Man", "Woman", "Non-binary", "My gender identity is not listed here","I prefer not to answer"],
      required: true,
      horizontal: false
    }, 
    {
      prompt: "<p>What is the highest level of school you have completed or the highest degree you have received??</p>",
      name: "demo_education",
      options: ["Less than high school", "High school diploma or equivalent (including GED)", "Some college, no degree", "Associate degree (2-years)", "Bachelor's degree (4-years)", "Master's degree", "Professional degree", "Doctorate degree", "I prefer not to answer"],
      required: true,
      horizontal: false
    }, 
    {
      prompt: "<p>How would you rate your social class?</p>",
      name: "demo_social_class",
      options: ["1 = lower/working", "2 = lower middle", "3 = middle", "4 = upper middle", "5 = upper class", "I prefer not to answer"],
      required: true,
    }, 
    {
      prompt: "<p>Which of the following best describes your marital status?</p>",
      name: "demo_marital_status",
      options: ["Never married", "Married/In a domestic partnership", "Widowed", "Divorced", "Other",  "I prefer not to answer"],
      required: true,
      horizontal: false
    }
  ],
}

var demographics_age = {
  type: jsPsychSurveyText,
  questions: [
    {
      prompt: "<p>What is your age in years?</p>",
      name: "demo_age",
      required: true,
      placeholder: "Enter your age here"
    }
  ],
}

var demographics_race = {
  type: jsPsychSurveyMultiSelect, 
  questions: [
    {
      prompt: "<p>What is your race/ethnicity. Select all that apply. </p>",
      options: ["Black or African American", "Hispanic or Latino", "White", "Asian", "Native American or Alaska Native", "Native Hawaiian or Other Pacific Islander",  "Middle Eastern","Other", "I prefer not to answer"],
      name: "demo_race", 
      required: true,
      horizontal: false
    },
    ]
  }

timeline.push(demographics, demographics_age, demographics_race);

var attention_check_3 = {
  type: jsPsychSurveyLikert,
  questions: [
    {
      prompt: "<p>How much attention did you pay to this study?</p>",
      name: "attention_check_3",
      labels: ["Almost none", "Very little", "Some", "A lot", "Almost all"],
      required: true
    }
  ]
}
timeline.push(attention_check_3);

//funnel questions 
var funnel_questions = {
  type: jsPsychSurveyText,
  questions: [
    {
      prompt: `<p>What do you think the study was about?</p>`,
      name: "funnel1",
      required: false
    },
    {
      prompt: `<p>What hypothesis/hypotheses do you think we were testing in this study?</p>`,
      name: "funnel2",
      required: false
    }, 
    {
      prompt: `<p>Do you have any feedback that could help us improve this study?</p>`,
      name: "funnel3",
      required: false
    }
  ]
};
timeline.push(funnel_questions); 

// save data using jsPsych-Pipe

const save_data = {
  type: jsPsychPipe,
  action: "save",
  experiment_id: "mWtUxPhRjQ2f",
  filename: filename,
  data_string: ()=>jsPsych.data.get().csv()
    };
timeline.push(save_data);

var debrief = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `<h3>Thank you for participating in this study!</h3>
  <p style = "width:1000px">I would like to discuss with you in more detail the study you just participated in and to explain exactly what we were trying to study. 

  Before I tell you about all the goals of this study, however, I want to explain why it is necessary in some kinds of studies to not tell people all about the procedures in which they will be asked to participate.

  As you may know, scientific methods sometimes require that participants in research studies not be given complete information about the research until after the study is completed. Although we cannot always tell you everything before you begin your participation, we do want to tell you everything when the study is completed. 

  We don't always tell people everything at the beginning of a study because we do not want to influence your responses. If we tell people what the purpose of the study is and what we predict about how they will react, then their reactions would not be a good indication of how they would react in everyday situations. 

  We were interested in how the degree of responsibility over resource outcomes influences feelings of envy. You played a round of Cyberball with someone where you either had or did not have the ability to pass the ball between each other to share the opportunity to earn money by passing to the Treasurer. Following this, you responded to emotion assessments regarding how you felt towards the person you played Cyberball with.

  If other people knew the true purpose of the study, it might affect how they behave/answer questions, so we are asking you not to share the information we just discussed. 

  Now that the study has been explained, do you agree to allow the investigator to use the data that we collected from your participation in this study? 

  I hope you enjoyed your experience and I hope you learned some things today. If you have any questions later please feel free to contact the researcher(s), Michael McCullough, Ph.D., Department of Psychology, University of California, San Diego, 9500 Gilman Drive, La Jolla, CA 92093-0109 and by email at memccullough@ucsd.edu. If you have any questions concerning your rights as a research subject, you may contact the UC San Diego Office of IRB Administration at irb@ucsd.edu or 858-246-4777.

  Do you have any other questions or comments about anything you did today or anything we've talked about? <br><br>

  Thank you again for your participation. Click the button to head to the Prolific to log completion, or be redirected in 5 minutes.<br><br>
  
  In the game, you could have received the ball a total of 4 to 8 times. This would mean you could've received a bonus of $0.20 to $0.40. However, we will be compensating you $1.00 regardless of how you did in the game. 
  </p>
  `, 
  choices: ["Prolific Completion"], 
  trial_duration: 300000, // 5 minutes before redirect
  on_finish: function(){
    //send participant to completion page for prolific 
    window.location.href = "https://app.prolific.com/submissions/complete?cc=C1S7TU83";  // PUT PROLIFIC COMPLETION URL HERE 
  }
}
timeline.push(debrief);

jsPsych.run(timeline);



</script>
</html>